{"version":3,"sources":["main.js"],"names":["basket","init","$","post","action","goodsOut","data","out","JSON","parse","key","hasOwnProperty","name","description","cost","img","html","on","addToBasket","isEmpty","prop","click","id","this","attr","undefined","showMiniBasket","saveBasket","localStorage","setItem","stringify","goods","delGoods","plusGoods","minusGoods","obj","loadBasket","getItem","sendEmail","val","tel","email","validName","validEmail","validTel","alert","find","trigger","indexOf","length","search","document","ready"],"mappings":"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","file":"main.js","sourcesContent":["var basket = {}; //корзина\r\nfunction init() {\r\n    //инициализация вывода на страницу\r\n    $.post(\"/core.php\", {\"action\": \"loadGoods\"}, goodsOut)\r\n}\r\n\r\nfunction goodsOut(data) { //функция, обеспечивающая вывод товаров на страницу\r\n    data = JSON.parse(data);\r\n    var out = \"\";\r\n    if (data != 0) {\r\n        for (var key in data) {\r\n            if (!data.hasOwnProperty(key)) continue;\r\n            out += \"<div class=\\\"pizza__slide clearfix\\\"><div class=\\\"pizza__text \\\">\";\r\n            out += \"<h2 class=\\\"pizza__name\\\">\" + data[key].name + \"  </h2>\";\r\n            out += \"<p class=\\\"pizza__desc\\\">\" + data[key].description + \"  </p>\";\r\n            out += \"<p class=\\\"pizza__cost\\\">\" + \"Цена: \" + data[key].cost + \"  </p>\";\r\n            out += \"<button data-id=\" + key + \" class=\\\"choose-btn\\\"><i class=\\\"fas fa-check\\\"></i> Выбрать</button>\";\r\n            out += \"</div><div class=\\\"pizza__img\\\"><img src=img/\" + data[key].img + \" alt=\\\"Пицца\\\"></div></div>\";\r\n        }\r\n    } else {\r\n        out = \"<h1> Товаров нет! </h1>\";\r\n    }\r\n    $(\".goods-out\").html(out);\r\n    $(\".choose-btn\").on(\"click\", addToBasket);\r\n}\r\n\r\nfunction addToBasket() { // функция, обеспечивающая добавление товаров в корзину\r\n    if (isEmpty(basket) && !$(\"#basket-toggle\").prop(\"checked\"))\r\n        $(\".basket-btn\").click();\r\n    var id = $(this).attr(\"data-id\");\r\n    basket[id] === undefined ? basket[id] = 1 : basket[id]++;\r\n    showMiniBasket();\r\n    saveBasket();\r\n}\r\n\r\nfunction saveBasket() { // Сохранение товаров в localStorage\r\n    localStorage.setItem(\"basket\", JSON.stringify(basket));\r\n}\r\n\r\nfunction showMiniBasket() { // Отрисовка корзины\r\n    if (isEmpty(basket)) {\r\n        $(\".basket-out\").html(\"<h3>Корзина пуста</h3>\");\r\n    } else {\r\n        $.post(\"/core.php\", {\"action\": \"loadGoods\"}, function (data) {\r\n            data = JSON.parse(data);\r\n            var cost = 0;\r\n            var goods = data;\r\n            var out = \"<div class=\\\" pizza-out\\\">\";\r\n            for (var id in basket) {\r\n                if (!basket.hasOwnProperty(id)) continue;\r\n                out += \"<div class=\\\"basket__pizza-wrap clearfix\\\"><div class=\\\"basket__pizza-txt\\\">\";\r\n                out += \"<h3 class=\\\"basket__pizza-name\\\">\" + goods[id].name + \"</h3>\";\r\n                out += \"<p class=\\\"basket__pizza-cost\\\"><span class=\\\"basket__pizza-lower\\\">Цена:</span>\" + goods[id].cost * basket[id];\r\n                out += \"<p class=\\\"basket__pizza-count\\\"><span class=\\\"basket__pizza-lower\\\">Количество:</span>\" + basket[id] + \"</p>\";\r\n                out += \"<span data-id=\\\"\" + id + \"\\\"  class=\\\"basket__pizza-plus\\\"><i class=\\\"fas fa-plus\\\"></i></span>\";\r\n                out += \"<spsn data-id=\\\"\" + id + \"\\\" class=\\\"basket__pizza-minus\\\"><i class=\\\"fas fa-minus\\\"></i></spsn>\";\r\n                out += \"</div><div class=\\\"basket__pizza-img\\\">\";\r\n                out += \"<img src=img/\" + goods[id].img + \" alt=\\\"Пицца\\\"></div>\";\r\n                out += \"<div  class=\\\"basket__pizza-del\\\" data-id=\" + id + \"><i class=\\\"fas fa-times\\\"></i></div></div>\";\r\n                cost = cost + goods[id].cost * basket[id];\r\n            }\r\n            out += \"</div><div class=\\\"order-form clearfix\\\">\";\r\n            out += \"<input type=\\\"email\\\"  id=\\\"input-email\\\" class=\\\"input-email\\\" placeholder=\\\"E-mail\\\">\";\r\n            out += \"<input type=\\\"text\\\"  id=\\\"input-name\\\" class=\\\"input-name\\\" placeholder=\\\"Имя\\\">\";\r\n            out += \"<input type=\\\"tel\\\"  id=\\\"input-tel\\\" class=\\\"input-tel\\\" placeholder=\\\"Телефон\\\">\";\r\n            out += \"<p class=\\\"cost-of-all\\\">Всего: \" + cost + \" грн.</p>\";\r\n            out += \"<button onclick=\\\"sendEmail()\\\" id=\\\"sbm-btn\\\" class=\\\"sbm-btn\\\">Заказать</button></div>\";\r\n\r\n            $(\".basket-out\").html(out);\r\n            $(\".basket__pizza-del\").on(\"click\", delGoods);\r\n            $(\".basket__pizza-plus\").on(\"click\", plusGoods);\r\n            $(\".basket__pizza-minus\").on(\"click\", minusGoods);\r\n        })\r\n    }\r\n}\r\n\r\nfunction delGoods() { // Удаление товаров из корзины\r\n    var id = $(this).attr(\"data-id\");\r\n    delete basket[id];\r\n    if (isEmpty(basket) && $(\"#basket-toggle\").prop(\"checked\"))\r\n        $(\".basket-btn\").click();\r\n    saveBasket();\r\n    showMiniBasket();\r\n}\r\n\r\nfunction plusGoods() { // Увеличение количества товара\r\n    var id = $(this).attr(\"data-id\");\r\n    basket[id]++;\r\n    saveBasket();\r\n    showMiniBasket();\r\n}\r\n\r\nfunction minusGoods() { // Уменьшение количесвта товара\r\n    var id = $(this).attr(\"data-id\");\r\n    basket[id] === 1 ? delete basket[id] : basket[id]--;\r\n    if (isEmpty(basket) && $(\"#basket-toggle\").prop(\"checked\"))\r\n        $(\".basket-btn\").click();\r\n    saveBasket();\r\n    showMiniBasket();\r\n}\r\n\r\nfunction isEmpty(obj) { // Проверка корзины на пустоту\r\n    for (var key in obj)\r\n        if (obj.hasOwnProperty(key))\r\n            return false;\r\n    return true;\r\n}\r\n\r\nfunction loadBasket() { // Выгрузка товаров из localStorage\r\n    if (localStorage.getItem(\"basket\")) {\r\n        basket = JSON.parse(localStorage.getItem(\"basket\"));\r\n        showMiniBasket();\r\n    }\r\n}\r\n\r\nfunction sendEmail() { // Функция отправки письма\r\n    var name = $(\"#input-name\").val();\r\n    var tel = $(\"#input-tel\").val();\r\n    var email = $(\"#input-email\").val();\r\n    if (validName(name) && validEmail(email) && validTel(tel)) {\r\n        if (!isEmpty(basket)) {\r\n            $.post(\r\n                \"mail.php\",\r\n                {\r\n                    \"name\": name,\r\n                    \"email\": email,\r\n                    \"tel\": tel,\r\n                    \"basket\": basket\r\n                },\r\n                function () {\r\n                    alert(\"Заказ отправлен\");\r\n                    $(this).find('input').val('');\r\n                    $('.order-form').trigger('reset');\r\n                }\r\n            );\r\n        } else {\r\n            alert(\"Корзина пуста!\")\r\n        }\r\n    } else {\r\n    }\r\n}\r\n\r\nfunction validEmail(email) { // Проверка E-mail\r\n    if (email.indexOf(\"@\") > 1 && email.indexOf(\".\") > 1) {\r\n        return true;\r\n    } else {\r\n       alert(\"Неправильный e-mail!\");\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction validName(name) { // Проверка имени\r\n    if (name.length > 1 && name.search(/\\d/) == -1) {\r\n        return true;\r\n    } else {\r\n       alert(\"Некорректное Имя!\");\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction validTel(tel) { // Проверка телефона\r\n    if (tel.search(/\\d/) == 0 && tel.search(/[A-Z]/i) == -1) {\r\n        return true;\r\n    } else {\r\n        alert(\"Некорректный телефон!\");\r\n        return false;\r\n    }\r\n}\r\n\r\n$(document).ready(function () { // начало работы\r\n    init();\r\n    loadBasket();\r\n    if (!isEmpty(basket)) {\r\n        $(\".basket-btn\").click();\r\n    }\r\n});"]}